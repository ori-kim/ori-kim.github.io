---
import { SideMenu } from '@/feature/components/SideMenu';
import { ThemeDropdown } from '@/feature/Theme/ThemeDropdown';
import { Separator } from '@/feature/ui/separator';
import { BackButton } from '@/layouts/component/BackButton';
import { DefaultHeader } from '@/layouts/component/DefaultHeader';
import PageLayout from '@/layouts/PageLayout.astro';
import PostsGrid from '@/layouts/PostsGrid.astro';
import { ContentBuilder } from '@/service/mdx';

export async function getStaticPaths() {
  const tags = await ContentBuilder.getAllTags();

  return tags.map((tag) => ({
    params: { slug: tag },
    props: { tag }
  }));
}

type Props = { tag: string };

const { tag } = Astro.props;

const document = await ContentBuilder.getByTag(tag);

const posts = [...document];
---

<PageLayout seo={{ title: `${tag} 관련 글 | Ateals`, description: `#${tag} 관련 글 모음` }}>
  <DefaultHeader client:load title={`#${tag}`} />

  <p>
    <span class="font-semibold">#{tag}</span> 관련 글 모음
  </p>

  <Separator className="mb-5" />

  {posts && <PostsGrid posts={posts} />}

  <SideMenu className="pt-20">
    <BackButton client:only="react" />
    <ThemeDropdown client:only="react" />
  </SideMenu>
</PageLayout>
